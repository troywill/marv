#!/usr/bin/env perl
use warnings;
use strict;

chomp(my $tty = `tty`);

exit unless ( $tty eq "/dev/tty1" );

# &wireless;

&connect_to_wireless;

sub connect_to_wireless {
    system("/etc/rc.d/asus-networking-perl");
}

&rails;
&detect_wireless;
&marv_menu;

sub marv_menu {
    exec '/usr/local/bin/marv-menu';
}

sub detect_wireless {
    system("sudo ip link set wlan0 up");
    system("sudo pass1.pl");
}

sub rails {
    chdir "/home/marv/rails/marv";
    system("sh server.sh 2>/dev/null&");
    print "Starting weight loss application ...\n";
}

# system("startx");


sub wireless {
    my $command = "wpa_supplicant -Dwext -iwlan0 -c/etc/wpa_supplicant.conf";
    print "=> sudo $command\n";
    system("sudo $command > /dev/null &");
    sleep 1;
    $command = "dhcpcd wlan0";
    print "=> sudo $command\n";
    system("sudo $command 2> /dev/null &");
}
