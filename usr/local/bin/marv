#!/usr/bin/env perl
use warnings;
use strict;
chomp(my $tty = `tty`);
exit unless ( $tty eq "/dev/tty1" );
&rails;
&detect_wireless;
&connect_to_wireless;
&marv_menu;
exit;

sub connect_to_wireless {
    # Connect to Claremont office if router is detected
    # Cell 01 - Address: 00:13:10:8D:40:1E
    my $claremont = '00:13:10:8D:40:1E';
    system("sudo ip link set wlan0 up");
    chomp( my $network_check = `sudo iwlist wlan0 scanning | grep $claremont` );
    system("/etc/rc.d/asus-networking-perl") if $network_check =~ /$claremont/;
}

sub marv_menu {
    print `clear`;
    exec '/usr/local/bin/marv-menu';
}

sub detect_wireless {
    system("sudo ip link set wlan0 up");
    system("sudo pass1.pl");
}

sub rails {
    chdir "/home/marv/rails/marv";
    system("sh server.sh 2>/dev/null&");
    print "Starting weight loss application ...\n";
}

# system("startx");


sub wireless {
    my $command = "wpa_supplicant -Dwext -iwlan0 -c/etc/wpa_supplicant.conf";
    print "=> sudo $command\n";
    system("sudo $command > /dev/null &");
    sleep 1;
    $command = "dhcpcd wlan0";
    print "=> sudo $command\n";
    system("sudo $command 2> /dev/null &");
}
